#!/usr/local/bin/python3
### carias@redhat.com
### Version 1

import time, sys
from selenium import webdriver
from selenium.webdriver.support.ui import Select

options = webdriver.ChromeOptions()
options.add_argument('--ignore-certificate-errors')
options.add_argument('headless')
options.add_argument('--no-sandbox')

# from selenium.webdriver.firefox.options import Options
# Define the webdriver to use.
driver = webdriver.Chrome(executable_path="/usr/bin/chromedriver", chrome_options=options)

# Go to the website
def go_to_main_site(lab_environment):
    driver.get('https://rol.redhat.com/' + lab_environment + '/app')
    time.sleep(3)


def go_to_course(lab_environment, course_id):
    driver.get('https://rol.redhat.com/' + lab_environment + '/app/courses/' + course_id)
    time.sleep(4)


def login():
    userid_login_box = driver.find_element_by_xpath("/html/body/div[1]/main/div/div/div[1]/div[2]/div[2]/div/section[1]/form/div[1]/input")
    userid_login_box.send_keys("{{ rh_username }}")

    next_button = driver.find_element_by_xpath('//*[@id="login-show-step2"]')
    next_button.click()
    time.sleep(3)

    passwd_login_box = driver.find_element_by_xpath('//*[@id="password"]')
    passwd_login_box.send_keys("{{ rh_password }}")

    login_button = driver.find_element_by_xpath('//*[@id="rh-password-verification-submit-button"]')
    login_button.click()
    time.sleep(4)

def accept_cookies():
    try:

        driver.switch_to.frame(driver.find_element_by_class_name('truste_popframe'))

        accept_cookies_button = driver.find_element_by_xpath('/html/body/div[8]/div[1]/div/div[3]/a[1]')
        accept_cookies_button.click()
        driver.execute_script("arguments[0].click();", accept_cookies_button)
        time.sleep(3)
    except:
        print("An exception occurred while accepting cookies")


def delete_labs():
    labs_tab = driver.find_element_by_xpath('//*[@id="course-tabs-tab-8"]/span[2]')
    labs_tab.click()
    time.sleep(2)

    try:
        delete_lab = driver.find_element_by_xpath("//*[text()='Delete']")
        delete_lab.click()
        
        #confirm_delete_lab = driver.find_element_by_xpath('/html/body/div[3]/div[2]/div/div/div[2]/button[1]')
        confirm_delete_lab = driver.find_element_by_xpath("//*[text()='Delete']")
        confirm_delete_lab.click()
    except:
        print("An exception occurred during lab deletion")


go_to_main_site("{{ lab_environment }}")
login()
accept_cookies()

{% for course in course_id -%}

go_to_course("{{ lab_environment }}", "{{ course }}")
delete_labs()

{% endfor -%}

driver.quit()
