#!/usr/local/bin/python3
### Maintained by carias@redhat.com

import time, sys
from selenium import webdriver
from selenium.webdriver.support.ui import Select

options = webdriver.ChromeOptions()
options.add_argument('--ignore-certificate-errors')
options.add_argument('headless')
options.add_argument('--no-sandbox')
options.add_argument("--window-size=1920,1080")

# from selenium.webdriver.firefox.options import Options
# Define the webdriver to use.
driver = webdriver.Chrome(executable_path="/usr/bin/chromedriver", chrome_options=options)

# Go to the website
def go_to_main_site(lab_environment):
    driver.get('https://rol.redhat.com/' + lab_environment + '/app')
    time.sleep(3)


def go_to_course(lab_environment, course_id):
    driver.get('https://rol.redhat.com/' + lab_environment + '/app/courses/' + course_id)
    time.sleep(4)


def login():
    userid_login_box = driver.find_element_by_xpath("/html/body/div[1]/main/div/div/div[1]/div[2]/div[2]/div/section[1]/form/div[1]/input")
    userid_login_box.send_keys("{{ rh_username }}")
    
    next_button = driver.find_element_by_xpath('//*[@id="login-show-step2"]')
    next_button.click()
    time.sleep(3)
    
    passwd_login_box = driver.find_element_by_xpath('//*[@id="password"]')
    passwd_login_box.send_keys("{{ rh_password }}")
    
    login_button = driver.find_element_by_xpath('//*[@id="rh-password-verification-submit-button"]')
    login_button.click()
    time.sleep(4)

def accept_cookies():
    try:

        driver.switch_to.frame(driver.find_element_by_class_name('truste_popframe'))
    
        accept_cookies_button = driver.find_element_by_xpath('/html/body/div[8]/div[1]/div/div[3]/a[1]')
        accept_cookies_button.click()
        driver.execute_script("arguments[0].click();", accept_cookies_button)
        time.sleep(3)
    except:
        print("An exception occurred while accepting cookies")


def create_lab():
    labs_tab = driver.find_element_by_xpath('//*[@id="course-tabs-tab-8"]/span[2]')
    labs_tab.click()
    time.sleep(3)
    
    try:    
#       create_start_lab = driver.find_element_by_xpath("//*[text()='Create']") # This one worked, and still works with Delete text
        create_start_lab = driver.find_element_by_xpath('//*[@id="tab-course-lab-environment"]/div/div[3]/button')
        create_start_lab.click()
    
        time.sleep(15)
    except:
        print("An exception occurred during lab creation")
        
def increase_lifespan_lab():
    try:
        labs_tab = driver.find_element_by_xpath('//*[@id="course-tabs-tab-8"]/span[2]')
        labs_tab.click()
        time.sleep(3)
    
        increase_lifespan = driver.find_element_by_xpath('//*[@id="tab-course-lab-environment"]/div/table/tr[2]/td[2]/button')
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
        increase_lifespan.click()
    except:
        print("An exception occurred during lifespan extension")


## Main

go_to_main_site("{{ lab_environment }}")
login()
accept_cookies()

{% for course in course_id -%}

go_to_course("{{ lab_environment }}", "{{ course }}")
create_lab()
increase_lifespan_lab()

{% endfor -%}

driver.quit()
