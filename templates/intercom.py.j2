#!/usr/local/bin/python3
### Maintained by carias@redhat.com

import time, sys, os.path
import pickle
from selenium import webdriver
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.common.by import By

options = webdriver.ChromeOptions()
options.add_argument('--ignore-certificate-errors')
options.add_argument("--window-size=1920,1080")
options.add_argument('headless')
options.add_argument('--no-sandbox')
options.add_argument("--user-data-dir=~/.config/google-chrome/intercom-profile-create")
options.add_argument("--enable-extensions")

## Define the webdriver to use.
## Chrome webdriver
driver = webdriver.Chrome(options=options)

# Go to the website
def go_to_main_site():
    driver.get("https://app.intercom.com/a/apps/jeuow7ss")
    time.sleep(2)

def login():

    try:
        driver.find_element("xpath", '/html/body/div[1]/div[2]/div/div/div/div/div[3]/a/div[2]').click()
        driver.find_element("xpath", '//*[@id="identifierId"]').send_keys("carias@redhat.com")
        driver.find_element("xpath", '/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[2]/div/div[1]/div/div/button/span').click()
        time.sleep(6)

        driver.find_element_by_xpath('//*[@id="username"]').send_keys("carias")
        driver.find_element_by_xpath('//*[@id="password"]').send_keys("{{ pin }}{{ token.stdout }}")
        driver.find_element_by_xpath('//*[@id="submit"]').click()
        time.sleep(10)
    except:
        print("An exception occurred while accepting during login")
        time.sleep(3)

def intercom_active_inactive():
    try:
        WebDriverWait(driver, 60).until(EC.element_to_be_clickable(
            (By.XPATH, '/html/body/div[1]/div[1]/div[1]/div/div/div/div/div[1]/div/div/div[3]/div/div'))).click()
        WebDriverWait(driver, 60).until(EC.element_to_be_clickable(
            (By.XPATH, '/html/body/div[1]/div[2]/div/div/div/div/div/div[1]/div[2]/div/div/button/span'))).click()
    except:
        print("An exception occurred while activating intercom")

## Main

go_to_main_site()
login()
intercom_active_inactive()
driver.quit()
