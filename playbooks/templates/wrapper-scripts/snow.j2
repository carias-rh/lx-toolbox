#!/bin/bash

VALID_ARGS=$(getopt -o :t:u:r:hd --long team:,user:,region:,help,debug -- "$@")
if [[ $? -ne 0 ]]; then
    exit 1;
fi

eval set -- "$VALID_ARGS"
while [ : ]; do
  case "$1" in
    -t | --team)
        TEAM=$2
        shift 2
        ;;
    -u | --user)
        USER_NAME=$2
        shift 2
        ;;
    -r | --region)
        REGION=$2
        shift 2
        ;;
    -d | --debug)
        DEBUG_MODE=true
        shift
        ;;
    --) shift;
        break
        ;;
    -h)
        echo "Usage: $(basename $0) [-t | --team arg] [-u | --user arg] [-d | --debug]"
        echo ""
        echo "Example:"
        echo "  $ $(basename $0) -t 'RHT Learner Experience - T2' -u 'Carlos arias' --debug"
        exit 1
        ;;
  esac
done

if [ -z "$DEBUG_MODE" ]; then
    DEBUG_MODE=false
fi

echo "User: $USER_NAME"
echo "Team: $TEAM"
echo "Region: $REGION"
echo "Debug mode: $DEBUG_MODE"

if [[ $TEAM == "RHT Learner Experience" ]]
  then
    TEAM_ACRONIM="LX-T1"
elif [[ $TEAM == "RHT Learner Experience - T2" ]]
  then
    TEAM_ACRONIM="LX-T2"
fi

if [[ $REGION == "" ]]
  then
    /usr/bin/ansible-playbook {{ playbook_dir }}/snow.yml \
      -e user_name="\"$USER_NAME\"" \
      -e team_name="\"$TEAM\"" \
      -e team_acronim="\"$TEAM_ACRONIM\"" \
      -e debug_mode="\"$DEBUG_MODE\""
    echo ""
    echo "---> Starting selenium script <---"
    /usr/bin/python /app/snow-$TEAM_ACRONIM.py
elif [[ $USER_NAME == "" ]]
  then
    /usr/bin/ansible-playbook {{ playbook_dir }}/snow.yml \
      -e region="\"$REGION\"" \
      -e team_name="\"$TEAM\"" \
      -e team_acronim="\"$TEAM_ACRONIM\"" \
      -e debug_mode="\"$DEBUG_MODE\""
    echo ""
    echo "---> Starting selenium script <---"
    /usr/bin/python /app/snow-$TEAM_ACRONIM.py
fi



