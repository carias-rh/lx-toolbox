#!/bin/bash
# LX Toolbox Wrapper - Start Lab
# Usage: start <course> [environment]
# Example: start 199
#          start do180 factory

set -e

# Auto-detect lx-tool location
if command -v lx-tool &> /dev/null; then
    LX_TOOL="lx-tool"
elif [[ -n "${LX_TOOLBOX_DIR}" ]] && [[ -x "${LX_TOOLBOX_DIR}/scripts/lx-tool" ]]; then
    LX_TOOL="${LX_TOOLBOX_DIR}/scripts/lx-tool"
elif [[ -x "/opt/lx-toolbox/scripts/lx-tool" ]]; then
    LX_TOOL="/opt/lx-toolbox/scripts/lx-tool"
else
    echo "Error: lx-tool not found. Please install lx-toolbox or set LX_TOOLBOX_DIR environment variable." >&2
    exit 1
fi

show_help() {
    echo "Usage: start <course> [environment]"
    echo ""
    echo "Start a lab for the specified course."
    echo ""
    echo "Arguments:"
    echo "  course       Course ID or short name (e.g., '199', 'do180', 'rh124-9.3')"
    echo "  environment  Optional: rol (default), factory, china"
    echo ""
    echo "Examples:"
    echo "  start 199              # Start rh199 (latest version) on ROL production"
    echo "  start do180            # Start do180 (latest version)"
    echo "  start do180 factory   # Start on Factory"
    echo "  start do180-4.14       # Start specific version"
}

if [[ $# -eq 0 ]] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    show_help
    exit 0
fi

COURSE="$1"
ENV="${2:-rol}"

echo ""
echo "Starting course: $COURSE"
echo "Environment: $ENV"
echo ""

exec $LX_TOOL lab start "$COURSE" --env "$ENV"

